# ğŸ”„ DIAGRAMA DE FLUJO: CLOUDFLARE TURNSTILE

## ğŸ“Š FLUJO COMPLETO (Usuario Real)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USUARIO ABRE FORMULARIO                          â”‚
â”‚                    https://pscielo.com                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸŒ FRONTEND (Next.js)                                              â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                          â”‚
â”‚                                                                      â”‚
â”‚  1. Se renderiza el componente <Turnstile />                        â”‚
â”‚  2. Cloudflare JavaScript carga en el navegador                     â”‚
â”‚  3. Analiza comportamiento del usuario:                             â”‚
â”‚     âœ“ Movimientos del mouse                                         â”‚
â”‚     âœ“ Velocidad de escritura                                        â”‚
â”‚     âœ“ Tiempo en la pÃ¡gina                                           â”‚
â”‚     âœ“ Interacciones con campos                                      â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚  Â¿Parece humano?      â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                                   â”‚
           â–¼                                   â–¼
      âœ… SÃ                                âš ï¸ DUDOSO
           â”‚                                   â”‚
           â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                          â”‚ Muestra desafÃ­o â”‚
           â”‚                          â”‚ (ej: puzzle)    â”‚
           â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                   â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Genera TOKEN Ãºnico       â”‚
         â”‚ Token = "cf-xxx-yyy-zzz" â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ setTurnstileToken("cf-xxx...")    â”‚
    â”‚ BotÃ³n "Enviar" se habilita        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 USUARIO COMPLETA FORMULARIO                          â”‚
â”‚                 Y PRESIONA "ENVIAR"                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸŒ FRONTEND - ValidaciÃ³n antes de enviar                           â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                            â”‚
â”‚                                                                      â”‚
â”‚  if (!turnstileToken) {                                             â”‚
â”‚    âŒ Rechazar: "Completa la verificaciÃ³n de seguridad"             â”‚
â”‚  }                                                                   â”‚
â”‚                                                                      â”‚
â”‚  âœ… Token existe â†’ Continuar                                         â”‚
â”‚                                                                      â”‚
â”‚  Payload enviado:                                                    â”‚
â”‚  {                                                                   â”‚
â”‚    name: "Juan PÃ©rez",                                              â”‚
â”‚    email: "juan@example.com",                                       â”‚
â”‚    message: "Hola, necesito informaciÃ³n",                           â”‚
â”‚    turnstileToken: "cf-xxx-yyy-zzz",  â† IMPORTANTE                  â”‚
â”‚    _security: { ... }                                               â”‚
â”‚  }                                                                   â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ POST https://psicodelcielo.com/submit
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ–¥ï¸  BACKEND (VPS - Express.js)                                     â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                   â”‚
â”‚                                                                      â”‚
â”‚  1. Recibe la solicitud                                             â”‚
â”‚  2. Extrae turnstileToken del body                                  â”‚
â”‚                                                                      â”‚
â”‚  3. VALIDACIÃ“N #0 (Prioridad mÃ¡xima):                               â”‚
â”‚     if (!turnstileToken) {                                          â”‚
â”‚       âŒ return 400: "VerificaciÃ³n de seguridad requerida"          â”‚
â”‚     }                                                                â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” BACKEND llama a Cloudflare API                                  â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                              â”‚
â”‚                                                                      â”‚
â”‚  async function verifyTurnstileToken(token, remoteIP) {             â”‚
â”‚                                                                      â”‚
â”‚    const formData = new URLSearchParams({                           â”‚
â”‚      secret: TURNSTILE_SECRET_KEY,                                  â”‚
â”‚      response: token,                                               â”‚
â”‚      remoteip: remoteIP                                             â”‚
â”‚    });                                                               â”‚
â”‚                                                                      â”‚
â”‚    fetch('https://challenges.cloudflare.com/turnstile/v0/siteverify', {â”‚
â”‚      method: 'POST',                                                â”‚
â”‚      body: formData                                                 â”‚
â”‚    })                                                                â”‚
â”‚  }                                                                   â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  ğŸŒ CLOUDFLARE VERIFICA      â”‚
              â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”      â”‚
              â”‚                              â”‚
              â”‚  â€¢ Â¿Token vÃ¡lido?            â”‚
              â”‚  â€¢ Â¿No expirado?             â”‚
              â”‚  â€¢ Â¿IP coincide?             â”‚
              â”‚  â€¢ Â¿No reutilizado?          â”‚
              â”‚  â€¢ Â¿Comportamiento humano?   â”‚
              â”‚                              â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                               â”‚
         â–¼                               â–¼
    âœ… SUCCESS                       âŒ FAIL
         â”‚                               â”‚
         â”‚                               â”‚
         â”‚                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cloudflare      â”‚          â”‚ Cloudflare         â”‚
â”‚ responde:       â”‚          â”‚ responde:          â”‚
â”‚                 â”‚          â”‚                    â”‚
â”‚ {               â”‚          â”‚ {                  â”‚
â”‚   "success": true,â”‚        â”‚   "success": false,â”‚
â”‚   "challenge_ts":â”‚         â”‚   "error-codes": [...] â”‚
â”‚   "hostname": ...,â”‚        â”‚ }                  â”‚
â”‚   ...           â”‚          â”‚                    â”‚
â”‚ }               â”‚          â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                               â”‚
         â”‚                               â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ–¥ï¸  BACKEND - DecisiÃ³n final                                       â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                       â”‚
â”‚                                                                      â”‚
â”‚  if (!isTurnstileValid) {                                           â”‚
â”‚    console.log("âŒ Token de Turnstile invÃ¡lido");                   â”‚
â”‚    return 400: "VerificaciÃ³n de seguridad fallÃ³";                   â”‚
â”‚  }                                                                   â”‚
â”‚                                                                      â”‚
â”‚  âœ… Token vÃ¡lido â†’ Continuar con validaciones adicionales           â”‚
â”‚                                                                      â”‚
â”‚  Validaciones restantes:                                            â”‚
â”‚  â€¢ Honeypot                                                         â”‚
â”‚  â€¢ Campos obligatorios                                              â”‚
â”‚  â€¢ Formato de email                                                 â”‚
â”‚  â€¢ Longitud de campos                                               â”‚
â”‚  â€¢ Tiempo en pÃ¡gina                                                 â”‚
â”‚  â€¢ Interacciones mÃ­nimas                                            â”‚
â”‚                                                                      â”‚
â”‚  âœ… Todas las validaciones pasadas                                   â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“§ ENVÃO DE EMAIL (Nodemailer + Zoho SMTP)                         â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                          â”‚
â”‚                                                                      â”‚
â”‚  const mailOptions = {                                              â”‚
â”‚    from: process.env.EMAIL_USER,                                    â”‚
â”‚    to: ["pscieloespacioterapeutico@gmail.com", ...],               â”‚
â”‚    subject: "ğŸ“© Nueva consulta desde pscielo",                     â”‚
â”‚    html: ...                                                        â”‚
â”‚  };                                                                  â”‚
â”‚                                                                      â”‚
â”‚  await transporter.sendMail(mailOptions);                           â”‚
â”‚                                                                      â”‚
â”‚  console.log("âœ… Email enviado exitosamente");                      â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… RESPUESTA AL FRONTEND                                           â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                         â”‚
â”‚                                                                      â”‚
â”‚  return 200: {                                                      â”‚
â”‚    message: "Mensaje enviado exitosamente"                          â”‚
â”‚  }                                                                   â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸŒ FRONTEND - Respuesta al usuario                                 â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                â”‚
â”‚                                                                      â”‚
â”‚  setFormMessage("Â¡Mensaje enviado con Ã©xito! Te responderemos...");â”‚
â”‚  formRef.current?.reset();                                          â”‚
â”‚  setTurnstileToken(""); // Limpiar token                            â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¤– FLUJO ALTERNATIVO (BOT Malicioso)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BOT INTENTA ENVIAR SPAM                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤– BOT ejecuta script automÃ¡tico                                   â”‚
â”‚                                                                      â”‚
â”‚  fetch('https://psicodelcielo.com/submit', {                        â”‚
â”‚    method: 'POST',                                                   â”‚
â”‚    body: JSON.stringify({                                           â”‚
â”‚      name: 'FaDWFiHVoxHNv',                                         â”‚
â”‚      email: 'spam@bot.com',                                         â”‚
â”‚      message: 'kJgvHegiAJk'                                         â”‚
â”‚      // âŒ NO tiene turnstileToken                                  â”‚
â”‚    })                                                                â”‚
â”‚  })                                                                  â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ–¥ï¸  BACKEND recibe solicitud                                       â”‚
â”‚                                                                      â”‚
â”‚  const { turnstileToken } = req.body;                               â”‚
â”‚  console.log("Token recibido:", turnstileToken);                    â”‚
â”‚  // â†’ undefined                                                     â”‚
â”‚                                                                      â”‚
â”‚  if (!turnstileToken) {                                             â”‚
â”‚    console.log("âŒ Rechazado: No se proporcionÃ³ token");            â”‚
â”‚    return res.status(400).json({                                    â”‚
â”‚      message: "VerificaciÃ³n de seguridad requerida"                 â”‚
â”‚    });                                                               â”‚
â”‚  }                                                                   â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  âŒ SOLICITUD RECHAZADA      â”‚
              â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”        â”‚
              â”‚                              â”‚
              â”‚  â€¢ No se envÃ­a email         â”‚
              â”‚  â€¢ No se procesa nada        â”‚
              â”‚  â€¢ Bot recibe error 400      â”‚
              â”‚  â€¢ Log registrado            â”‚
              â”‚                              â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Â¿POR QUÃ‰ ES IMPOSIBLE FALSIFICAR?

### âŒ Intento de falsificaciÃ³n:

```javascript
// Bot intenta enviar un token falso
fetch('https://psicodelcielo.com/submit', {
  method: 'POST',
  body: JSON.stringify({
    name: 'Bot Test',
    email: 'bot@test.com',
    message: 'Spam',
    turnstileToken: 'token-falso-123'  // â† Token inventado
  })
})
```

### âœ… Lo que sucede:

```
1. Backend recibe: "token-falso-123"
   â”‚
   â–¼
2. Backend llama a Cloudflare:
   POST https://challenges.cloudflare.com/turnstile/v0/siteverify
   Body: {
     secret: "TU_SECRET_KEY",
     response: "token-falso-123",
     remoteip: "192.168.1.1"
   }
   â”‚
   â–¼
3. Cloudflare busca el token en su base de datos
   â”‚
   â–¼
4. Cloudflare responde:
   {
     "success": false,
     "error-codes": ["invalid-input-response"]
   }
   â”‚
   â–¼
5. Backend rechaza la solicitud:
   return 400: "VerificaciÃ³n de seguridad fallÃ³"
```

**Â¿Por quÃ© funciona?**
- Los tokens son generados SOLO por Cloudflare
- Cada token es Ãºnico y de un solo uso
- Cloudflare valida que el token fue generado para esa IP
- Los tokens expiran en ~300 segundos
- No se pueden reutilizar ni falsificar

---

## ğŸ“ˆ ESTADÃSTICAS DE PROTECCIÃ“N

### Sin Turnstile:
```
100 intentos de spam
  â†“
8 pasan las validaciones (92% bloqueados)
  â†“
âŒ 8 emails spam en tu bandeja
```

### Con Turnstile:
```
100 intentos de spam
  â†“
99.9 bloqueados por Turnstile
  â†“
0.1 pasa (1 cada 1000)
  â†“
âœ… Casi 0 emails spam
```

---

## ğŸ¯ PUNTOS CLAVE

1. **Doble verificaciÃ³n**: Frontend + Backend
2. **Tokens Ãºnicos**: Cada verificaciÃ³n genera un token nuevo
3. **ValidaciÃ³n externa**: Cloudflare verifica, no tu cÃ³digo
4. **Machine Learning**: Cloudflare usa IA para detectar bots
5. **Imposible de saltear**: Sin token vÃ¡lido = sin email

---

**Diagrama creado:** 25 de enero de 2025
**VersiÃ³n:** 1.0
